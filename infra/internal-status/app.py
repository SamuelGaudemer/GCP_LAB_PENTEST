from flask import Flask,request,render_template_string, render_template, abort
import base64
import subprocess
app = Flask(__name__)



@app.route('/')
def my_form():
    return render_template('home.html')
    
@app.route('/' , methods=['POST'])
def my_form_post():
 url= request.form['url']
 header=request.form['header']
 process = subprocess.Popen(['curl', url,'-H',header], stdout=subprocess.PIPE)
 stdout = process.communicate()[0]    
 stdoutb64 = base64.b64encode(stdout).decode('utf-8')

 return render_template('home.html', sortie=stdoutb64)

@app.route('/admin' , methods=['GET'])
def admin():
 page = request.args.get('page')
 username = request.args.get('username')
 password = request.args.get('password')
 template = ""
 if(username == "administratorPixel" and password == "summer2020?!unbruteforcable"):
  template = '''
    <!DOCTYPE html>
    <html>
<head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body>
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item active" aria-current="page">ADMIN PANEL</li>
  </ol>
</nav>
''' 
  if(page == '1' or page == None):
   template = template + '''
<div class="card" style="width: 18rem;">
  <div class="card-body">
    <h5 class="card-title">Panel en construction</h5>
    <h6 class="card-subtitle mb-2 text-muted">Administration</h6>
    <p class="card-text">L'administrateur pourra voir la liste compl√®te de ses utilisateurs et effectuer des actions d'administration (ajouter, supprimer, modifier). </p>
  </div>
</div>
'''
  template = template + '''
<nav aria-label="Page navigation example">
  <ul class="pagination">
    <li class="page-item"><a class="page-link" href="/admin?page=1">1</a></li>
    <li class="page-item"><a class="page-link" href="/admin?page=2">2</a></li>
    <li class="page-item"><a class="page-link" href="/admin?page=3">3</a></li>

  </ul>
</nav>
<h6><span class="badge badge-secondary">Page numero : {}</span></h6>

</body>

    </html>
        '''.format(page)
  return render_template_string(template)
 else:
  abort(403)
if __name__ == '__main__':
    app.run(host ='0.0.0.0', port = 80, debug = True)
