#!/bin/bash


# Deleting the instance
pid=$(gcloud config list --format 'value(core.project)' ) > /dev/null 2>&1 


gcloud config set project $pid > /dev/null 2>&1

echo "Deleting the Compute instance"

gcloud compute instances delete test --zone=asia-east1-a -q > /dev/null 2>&1 

# deleting firewall

echo "Deleting the Compute Firewall"

gcloud compute firewall-rules delete http2 -q > /dev/null 2>&1 

# deleting bucket

echo "Deleting the bucket"
pid=$(gcloud config list --format 'value(core.project)' )  

gsutil rm -r gs://$pid/ 
gsutil rm -r gs://$pid-credit-card/
echo "Bucket Deleted Successfully"

# delete service account
name=$1

if [[ -n "$name" ]]; then
echo "Deleting the Service account"
email=$(gcloud iam service-accounts list --filter "$name" | sed -n 2P | awk -F ' '  '{print $2}') 

gcloud iam service-accounts delete $email -q 